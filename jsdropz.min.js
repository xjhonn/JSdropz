/* -----------------------------------------------
/* Author : Jonatan dos Santos
/* MIT license: http://opensource.org/licenses/MIT
/* GitHub : https://github.com/xjhonn/JSdropz
/* Como usar? Leya description en GITHUB
/* v1.0
/* ----------------------------------------------- */
var ajax, selectorfina; $(document).on("click", ".jsdropz_btn_cancelar", function () { ajax.abort(), ajax.onload = function () { form.querySelector("#jsdropz__uploading_progress").innerHTML = "" }, $(selectorfina + " #jsdropz__uploading_progress").html("Cancelado.") }), $.fn.JSdropz = function () { var a, b = {}; this.length && $.each(this[0].attributes, function (a, c) { b[c.name] = c.value }), b.class && b.id ? a = "#" + b.id : b.class ? a = "." + b.class : b.id && (a = "#" + b.id), selectorfina = a; var c = $.extend({ input: "input[type=\"file\"]", callback: function () { } }, arguments[0] || {}), d = function () { var a = document.createElement("div"); return ("draggable" in a || "ondragstart" in a && "ondrop" in a) && "FormData" in window && "FileReader" in window }(); $(selectorfina + " .jsdropz__input").prepend("<svg class=\"jsdropz__icon\" xmlns=\"http://www.w3.org/2000/svg\" width=\"50\" height=\"43\" viewBox=\"0 0 50 43\"> <path d=\"M48.4 26.5c-.9 0-1.7.7-1.7 1.7v11.6h-43.3v-11.6c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v13.2c0 .9.7 1.7 1.7 1.7h46.7c.9 0 1.7-.7 1.7-1.7v-13.2c0-1-.7-1.7-1.7-1.7zm-24.5 6.1c.3.3.8.5 1.2.5.4 0 .9-.2 1.2-.5l10-11.6c.7-.7.7-1.7 0-2.4s-1.7-.7-2.4 0l-7.1 8.3v-25.3c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v25.3l-7.1-8.3c-.7-.7-1.7-.7-2.4 0s-.7 1.7 0 2.4l10 11.6z\" /></svg>"), $(selectorfina + " .jsdropz__input").append("<div class=\"jsdropz__uploading\"><center></center><br><center><font id=\"jsdropz__uploading_progress\"></font></center><center><br><font id=\"jsdropz__uploading_progress_cancel\"><a href=\"javascript:void(0)\" class=\"btn btn-sm btn-danger jsdropz_btn_cancelar\">cancelar</a></font></center></div><div class=\"jsdropz__success\">Done! <a href=\"javascript:void(0)\" class=\"jsdropz__restart\" role=\"button\">Subir m\xE1s?</a></div><div class=\"jsdropz__error\">Error! <span></span>. <a href=\"javascript:void(0)\" class=\"jsdropz__restart\" role=\"button\">Try again!</a></div>"), $(selectorfina + " .jsdropz__input").append("<button type=\"submit\" class=\"jsdropz__button\">Cargar</button>"); var f = document.querySelector(a), g = f.querySelector(c.input), h = f.querySelector("label"), i = f.querySelector(".jsdropz__error span"), j = f.querySelectorAll(".jsdropz__restart"), k = !1, l = function (a) { h.textContent = 1 < a.length ? (g.getAttribute("data-multiple-caption") || "").replace("{count}", a.length) : a[0].name }, m = function () { var a = document.createEvent("HTMLEvents"); a.initEvent("submit", !0, !1), f.dispatchEvent(a) }; g.addEventListener("change", function (a) { l(a.target.files), m() }), d && (f.classList.add("has-advanced-upload"), ["drag", "dragstart", "dragend", "dragover", "dragenter", "dragleave", "drop"].forEach(function (a) { f.addEventListener(a, function (a) { a.preventDefault(), a.stopPropagation() }) }), ["dragover", "dragenter"].forEach(function (a) { f.addEventListener(a, function () { f.classList.add("is-dragover") }) }), ["dragleave", "dragend", "drop"].forEach(function (a) { f.addEventListener(a, function () { f.classList.remove("is-dragover") }) }), f.addEventListener("drop", function (a) { k = a.dataTransfer.files, l(k), m() })), f.addEventListener("submit", function (a) { if ($(".jsdropz__icon").hide(), f.classList.contains("is-uploading")) return !1; if (f.classList.add("is-uploading"), f.classList.remove("is-error"), d) { a.preventDefault(); var b = new FormData(f); k && Array.prototype.forEach.call(k, function (a) { b.append(g.getAttribute("name"), a) }), ajax = new XMLHttpRequest, ajax.open(f.getAttribute("method"), f.getAttribute("action"), !0), ajax.onload = function (a) { f.querySelector("#jsdropz__uploading_progress").innerHTML = "", c.callback.call(this, ajax, a, a.currentTarget.response) }, ajax.upload.addEventListener("progress", function (a) { if (a.lengthComputable) { var b = a.loaded / a.total; console.log(b), f.querySelector("#jsdropz__uploading_progress").innerHTML = (100 * b).toFixed(2) + "%" } }, !1), ajax.onerror = function () { f.querySelector("#jsdropz__uploading_progress").innerHTML = "", c.callback.call(this, 0, 0, "Error de subida.") }, ajax.send(b) } else { var e = "uploadiframe" + new Date().getTime(), h = document.createElement("iframe"); $iframe = $("<iframe name=\"" + e + "\" style=\"display: none;\"></iframe>"), h.setAttribute("name", e), h.style.display = "none", document.body.appendChild(h), f.setAttribute("target", e), h.addEventListener("load", function () { var a = JSON.parse(h.contentDocument.body.innerHTML); f.classList.remove("is-uploading"), f.classList.add(!0 == a.success ? "is-success" : "is-error"), f.removeAttribute("target"), a.success || (i.textContent = a.error), h.parentNode.removeChild(h) }) } }), Array.prototype.forEach.call(j, function (a) { a.addEventListener("click", function (a) { a.preventDefault(), f.classList.remove("is-error", "is-success"), g.click() }) }), g.addEventListener("focus", function () { g.classList.add("has-focus") }), g.addEventListener("blur", function () { g.classList.remove("has-focus") }) };